document.addEventListener("DOMContentLoaded",()=>{const{translations:e,whatsappNumber:t,locale:n}=window.DjamoePageData||{};if(!e||!t||!n)return void console.error("❌ DjamoePageData not found. Product script will not run.");const o=t,i=document.getElementById("category-view"),l=document.getElementById("product-view"),d=document.getElementById("category-grid"),r=document.getElementById("product-grid"),s=document.getElementById("no-results"),a=document.getElementById("back-to-categories"),c=document.getElementById("product-view-title"),u=document.getElementById("description-modal"),m=document.getElementById("modal-content-wrapper"),p=document.getElementById("modal-close-btn"),g=document.getElementById("modal-body");if(!(i&&l&&d&&r&&s&&a&&c&&u&&m&&p&&g))return void console.error("❌ One or more product page elements are missing from the DOM.");function f(){u.classList.add("opacity-0"),m.classList.add("scale-95"),setTimeout(()=>{u.classList.add("hidden"),document.documentElement.style.overflow="",g.innerHTML=""},300)}d.addEventListener("click",t=>{const o=t.target.closest(".category-card");var d,a;o&&(i.classList.add("hidden"),l.classList.remove("hidden"),d=o.dataset.categoryId,a=o.dataset.categoryName,c.textContent=a,r.innerHTML=`\n            <div class="col-span-full text-center py-16">\n                <div class="w-12 h-12 mx-auto border-4 loading-spinner rounded-full mb-4"></div>\n                <p class="text-[#1A3A24]/70 text-lg font-medium">${e.loadingProducts}</p>\n            </div>\n        `,fetch(`/produk/kategori/${d}?locale=${n}`).then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()}).then(t=>{s.classList.toggle("hidden",t.products.length>0),r.innerHTML="",t.products.length>0&&(t.products.forEach((t,o)=>{const i=new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(t.price),l="object"==typeof t.product_name&&null!==t.product_name?t.product_name[n]||t.product_name.id:t.product_name||e.productNameNotAvailable,d=document.createElement("div");d.className="product-card group flex flex-col h-full reveal-animation",d.style.transitionDelay=50*o+"ms",d.innerHTML=`\n                            <div class="relative overflow-hidden bg-gray-50">\n                                ${t.is_bestseller?`\n                                    <div class="best-seller-tag">\n                                        <i data-lucide="star" class="w-3 h-3 inline-block mr-1"></i>\n                                        ${e.bestSeller}\n                                    </div>\n                                `:""}\n                                \n                                <img src="/storage/${t.image_url}" \n                                     alt="${l}" \n                                     class="product-image description-btn w-full h-48 sm:h-56 object-cover cursor-pointer" \n                                     data-product-id="${t.id}" \n                                     loading="eager" \n                                     fetchpriority="high"\n                                     decoding="sync" \n                                     onerror="this.src='https://placehold.co/400x400/1a3a24/E6D793?text=Jamu'">\n                                \n                                <div class="absolute inset-0 bg-[#1A3A24]/0 group-hover:bg-[#1A3A24]/10 transition-all duration-300 pointer-events-none"></div>\n                            </div>\n                            \n                            <div class="p-4 sm:p-5 flex flex-col flex-grow relative z-10">\n                                <h3 class="product-title text-base sm:text-lg font-serif font-bold mb-2 line-clamp-2 leading-tight min-h-[3rem]">\n                                    ${l}\n                                </h3>\n                                \n                                <div class="flex-grow"></div>\n                                \n                                <div class="mt-4 pt-4 border-t border-[#1A3A24]/10 group-hover:border-[#E6D793]/30 transition-colors duration-300">\n                                    <p class="product-price text-base sm:text-lg font-sans font-bold mb-3">\n                                        ${i}\n                                    </p>\n                                    \n                                    <button data-product-id="${t.id}" \n                                            class="detail-btn description-btn w-full py-2.5 px-4 rounded-full text-xs sm:text-sm font-bold uppercase tracking-wider transition-all duration-300 flex items-center justify-center gap-2">\n                                        <i data-lucide="eye" class="w-4 h-4"></i>\n                                        ${e.viewDetails}\n                                    </button>\n                                </div>\n                            </div>\n                        `,r.appendChild(d)}),"undefined"!=typeof lucide&&lucide.createIcons(),setTimeout(()=>{document.querySelectorAll(".reveal-animation").forEach(e=>{e.classList.add("active")})},50))}).catch(t=>{console.error("❌ Error fetching products:",t),r.innerHTML=`\n                    <div class="col-span-full text-center py-16">\n                        <div class="bg-white rounded-2xl shadow-soft p-12 max-w-md mx-auto">\n                            <i data-lucide="alert-circle" class="w-16 h-16 mx-auto mb-4 text-red-400"></i>\n                            <h3 class="text-xl font-bold text-[#1A3A24] mb-2">${e.loadProductFailed}</h3>\n                            <button onclick="location.reload()" class="mt-4 px-6 py-2 bg-[#E6D793] text-[#1A3A24] rounded-full font-bold hover:bg-[#D4C078] transition-colors">\n                                Coba Lagi\n                            </button>\n                        </div>\n                    </div>\n                `,"undefined"!=typeof lucide&&lucide.createIcons()}),window.scrollTo({top:l.offsetTop-100,behavior:"smooth"}))}),a.addEventListener("click",()=>{l.classList.add("hidden"),i.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"})}),r.addEventListener("click",t=>{const i=t.target.closest(".description-btn");var l;i&&(l=i.dataset.productId,u.classList.remove("hidden"),setTimeout(()=>{u.classList.remove("opacity-0"),m.classList.remove("scale-95")},10),document.documentElement.style.overflow="hidden",g.innerHTML=`\n            <div class="text-center py-16 px-6">\n                <div class="w-12 h-12 mx-auto border-4 loading-spinner rounded-full mb-4"></div>\n                <p class="text-[#1A3A24]/70 text-lg font-medium">${e.loadingDetails}</p>\n            </div>\n        `,fetch(`/produk/detail/${l}?locale=${n}`).then(e=>e.json()).then(t=>{const i=new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(t.price),l="object"==typeof t.product_name&&null!==t.product_name?t.product_name[n]||t.product_name.id:t.product_name||e.productNameNotAvailable;let d=null;t.full_description&&(d="object"==typeof t.full_description?t.full_description[n]:t.full_description),!d&&t.description&&(d="object"==typeof t.description?t.description[n]:t.description),!d&&t.full_description&&"object"==typeof t.full_description&&(d=t.full_description.id);const r=d&&""!==String(d).trim()?d:e.descriptionNotAvailable,s=`https://wa.me/${o}?text=Halo, saya tertarik dengan produk ${encodeURIComponent(l)}`;g.innerHTML=`\n                    <div class="modal-image-container relative w-full h-64 md:h-80">\n                        <img src="/storage/${t.image_url}" \n                             alt="${l}" \n                             class="w-full h-full object-cover" \n                             loading="eager"\n                             fetchpriority="high"\n                             decoding="sync"\n                             onerror="this.src='https://placehold.co/600x600/1a3a24/E6D793?text=Jamu'">\n                    </div>\n                    \n                    <div class="modal-content">\n                        ${t.is_bestseller?`\n                            <div class="inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-[#E6D793] to-[#D4C078] text-[#1A3A24] rounded-full text-sm font-bold uppercase mb-4">\n                                <i data-lucide="star" class="w-4 h-4"></i>\n                                ${e.bestSeller}\n                            </div>\n                        `:""}\n                        \n                        <h3 class="text-2xl md:text-3xl font-serif font-bold text-[#1A3A24] mb-3 leading-tight">\n                            ${l}\n                        </h3>\n                        <p class="text-xl md:text-2xl font-sans font-bold text-[#C5A059]">\n                            ${i}\n                        </p>\n                        <div class="prose prose-sm md:prose-base max-w-none">\n                            <div class="text-[#1A3A24]/80 leading-relaxed break-words ">\n                                ${r}\n                            </div>\n                        </div>\n                        <a href="${s}" target="_blank" \n                           class="whatsapp-btn mt-8 w-full py-4 px-6 rounded-full text-white font-bold text-base flex items-center justify-center gap-3 transition-all duration-300 hover:scale-105 active:scale-95">\n                            <i data-lucide="message-circle" class="w-5 h-5"></i>\n                            ${e.orderViaWhatsApp}\n                        </a>\n                    </div>\n                `,"undefined"!=typeof lucide&&lucide.createIcons()}).catch(t=>{console.error("❌ Error fetching product detail:",t),g.innerHTML=`\n                    <div class="text-center py-16 px-6">\n                        <i data-lucide="alert-circle" class="w-16 h-16 mx-auto mb-4 text-red-400"></i>\n                        <h3 class="text-xl font-bold text-[#1A3A24] mb-2">${e.loadDetailFailed}</h3>\n                        <button onclick="this.closest('#description-modal').querySelector('#modal-close-btn').click()" class="mt-4 px-6 py-2 bg-[#E6D793] text-[#1A3A24] rounded-full font-bold hover:bg-[#D4C078] transition-colors">\n                            Tutup\n                        </button>\n                    </div>\n                `,"undefined"!=typeof lucide&&lucide.createIcons()}))}),p.addEventListener("click",f),u.addEventListener("click",e=>{e.target===u&&f()}),document.addEventListener("keydown",e=>{"Escape"!==e.key||u.classList.contains("hidden")||f()});const h=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&e.target.classList.add("active")})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});document.querySelectorAll(".reveal-animation").forEach(e=>h.observe(e)),console.log("✅ Product page initialized successfully")});
